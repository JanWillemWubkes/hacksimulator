<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cache Diagnostic - HackSimulator.nl</title>

    <!-- Load actual site stylesheets to test -->
    <link rel="stylesheet" href="styles/main.css?v=20251029-1915-nocache">

    <style>
        body {
            font-family: 'Courier New', monospace;
            background: #000;
            color: #00ff88;
            padding: 20px;
            max-width: 1000px;
            margin: 0 auto;
        }
        h1 { color: #00ffff; }
        .section {
            background: #0a0a0a;
            border: 1px solid #333;
            padding: 15px;
            margin: 15px 0;
            border-radius: 4px;
        }
        .pass { color: #00ff88; }
        .fail { color: #ff0055; }
        .warning { color: #ffaa00; }
        pre {
            background: #1a1a1a;
            padding: 10px;
            overflow-x: auto;
            border-left: 3px solid #00ff88;
        }
        button {
            background: #00ff88;
            color: #000;
            border: none;
            padding: 10px 20px;
            font-family: 'Courier New', monospace;
            font-weight: bold;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #33ffaa; }
    </style>
</head>
<body>
    <h1>üîç HackSimulator Cache Diagnostic</h1>

    <div class="section">
        <h2>Quick Actions</h2>
        <button onclick="runDiagnostics()">‚ñ∂ Run Full Diagnostics</button>
        <button onclick="clearAllCache()">üóëÔ∏è Clear All Cache</button>
        <button onclick="location.reload(true)">üîÑ Hard Reload</button>
    </div>

    <div id="results"></div>

    <script>
        async function runDiagnostics() {
            const results = document.getElementById('results');
            results.innerHTML = '<p>Running diagnostics...</p>';

            let output = '';

            // 1. Check CSS Variables
            output += '<div class="section"><h2>1Ô∏è‚É£ CSS Variables (Grid Color)</h2>';
            const gridColor = getComputedStyle(document.documentElement)
                .getPropertyValue('--grid-color-base') || 'NOT LOADED';

            if (gridColor.includes('42, 42, 42')) {
                output += `<p class="pass">‚úÖ CORRECT: ${gridColor}</p>`;
                output += `<p class="pass">Expected: rgba(42, 42, 42, 0.8) - Dark grey</p>`;
            } else {
                output += `<p class="fail">‚ùå WRONG: ${gridColor}</p>`;
                output += `<p class="fail">Expected: rgba(42, 42, 42, 0.8)</p>`;
            }
            output += '</div>';

            // 2. Check Loaded Stylesheets
            output += '<div class="section"><h2>2Ô∏è‚É£ Loaded Stylesheets</h2>';
            const stylesheets = Array.from(document.styleSheets)
                .filter(sheet => sheet.href)
                .map(sheet => {
                    const url = new URL(sheet.href);
                    const version = url.searchParams.get('v') || 'NO VERSION';
                    return { href: sheet.href, version };
                });

            stylesheets.forEach(sheet => {
                const isCorrect = sheet.version === '20251029-grid-readability';
                const status = isCorrect ? '‚úÖ' : '‚ùå';
                const cls = isCorrect ? 'pass' : 'fail';
                output += `<p class="${cls}">${status} Version: ${sheet.version}</p>`;
                output += `<pre>${sheet.href}</pre>`;
            });
            output += '</div>';

            // 3. Check Browser Cache Storage
            output += '<div class="section"><h2>3Ô∏è‚É£ Cache Storage</h2>';
            if ('caches' in window) {
                const cacheNames = await caches.keys();
                if (cacheNames.length > 0) {
                    output += `<p class="warning">‚ö†Ô∏è Found ${cacheNames.length} cache(s):</p>`;
                    cacheNames.forEach(name => {
                        output += `<pre>${name}</pre>`;
                    });
                } else {
                    output += `<p class="pass">‚úÖ No service worker caches found</p>`;
                }
            } else {
                output += `<p>Cache API not available</p>`;
            }
            output += '</div>';

            // 4. Check localStorage
            output += '<div class="section"><h2>4Ô∏è‚É£ LocalStorage</h2>';
            const lsKeys = Object.keys(localStorage).filter(k => k.startsWith('hacksim_'));
            output += `<p>HackSim keys: ${lsKeys.length}</p>`;
            lsKeys.forEach(key => {
                const value = localStorage.getItem(key);
                const preview = value.length > 100 ? value.substring(0, 100) + '...' : value;
                output += `<p><strong>${key}:</strong> ${preview}</p>`;
            });
            output += '</div>';

            // 5. Network Timing
            output += '<div class="section"><h2>5Ô∏è‚É£ Performance Timing</h2>';
            const perfData = performance.getEntriesByType('navigation')[0];
            if (perfData) {
                output += `<pre>`;
                output += `Load Time: ${(perfData.loadEventEnd - perfData.fetchStart).toFixed(0)}ms\n`;
                output += `DNS Lookup: ${(perfData.domainLookupEnd - perfData.domainLookupStart).toFixed(0)}ms\n`;
                output += `Response Time: ${(perfData.responseEnd - perfData.requestStart).toFixed(0)}ms\n`;
                output += `DOM Processing: ${(perfData.domComplete - perfData.domLoading).toFixed(0)}ms\n`;
                output += `</pre>`;
            }
            output += '</div>';

            // 6. Browser Info
            output += '<div class="section"><h2>6Ô∏è‚É£ Browser Info</h2>';
            output += `<pre>`;
            output += `User Agent: ${navigator.userAgent}\n`;
            output += `Platform: ${navigator.platform}\n`;
            output += `Cookie Enabled: ${navigator.cookieEnabled}\n`;
            output += `Online: ${navigator.onLine}\n`;
            output += `</pre>`;
            output += '</div>';

            results.innerHTML = output;
        }

        async function clearAllCache() {
            if (confirm('This will clear all cache and reload. Continue?')) {
                // Clear cache storage
                if ('caches' in window) {
                    const cacheNames = await caches.keys();
                    await Promise.all(cacheNames.map(name => caches.delete(name)));
                }

                // Clear localStorage (backup first)
                const backup = { ...localStorage };
                console.log('LocalStorage backup:', backup);
                localStorage.clear();

                alert('Cache cleared! Page will reload.');
                location.reload(true);
            }
        }

        // Auto-run on load
        window.addEventListener('load', runDiagnostics);
    </script>
</body>
</html>
