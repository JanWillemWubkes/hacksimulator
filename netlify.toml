# Netlify configuration for HackSimulator.nl
# Documentation: https://docs.netlify.com/configure-builds/file-based-configuration/

[build]
  # Publish directory (root of repo for vanilla JS)
  publish = "."

  # No build command needed (vanilla JS, no bundler)
  command = "echo 'No build step required for vanilla JS'"

# Build settings
[build.processing]
  skip_processing = true  # Disable Netlify asset optimization (we manage bundle size manually)

# Cache busting settings
[build.environment]
  NODE_VERSION = "18"

# Redirects (SPA fallback - disabled for now, not needed for vanilla JS)
# [[redirects]]
#   from = "/*"
#   to = "/index.html"
#   status = 200

# Custom Domain Redirects (Activate when hacksimulator.nl is live)
# Uncomment these redirects after domain is configured in Netlify

# Redirect www to apex domain
# [[redirects]]
#   from = "https://www.hacksimulator.nl/*"
#   to = "https://hacksimulator.nl/:splat"
#   status = 301
#   force = true

# Force HTTPS
# [[redirects]]
#   from = "http://hacksimulator.nl/*"
#   to = "https://hacksimulator.nl/:splat"
#   status = 301
#   force = true

# [[redirects]]
#   from = "http://www.hacksimulator.nl/*"
#   to = "https://hacksimulator.nl/:splat"
#   status = 301
#   force = true

# Optional: Redirect old Netlify subdomain to custom domain
# [[redirects]]
#   from = "https://famous-frangollo-b5a758.netlify.app/*"
#   to = "https://hacksimulator.nl/:splat"
#   status = 301
#   force = false

# Security Headers
[[headers]]
  for = "/*"
  [headers.values]
    # Prevent clickjacking
    X-Frame-Options = "SAMEORIGIN"

    # Prevent MIME sniffing
    X-Content-Type-Options = "nosniff"

    # XSS Protection
    X-XSS-Protection = "1; mode=block"

    # Referrer Policy
    Referrer-Policy = "strict-origin-when-cross-origin"

    # Cross-Origin-Opener-Policy (M5 Best Practices: Isolate browsing context)
    Cross-Origin-Opener-Policy = "same-origin"

    # Content Security Policy (M5 Performance: Moved from HTML meta tag for faster parsing)
    # 'unsafe-hashes' allows onload event handlers for deferred CSS loading
    # font-src 'self' data: allows base64 inline fonts in main.css
    Content-Security-Policy = "default-src 'self'; script-src 'self' 'unsafe-hashes' https://www.googletagmanager.com; style-src 'self' 'unsafe-inline'; font-src 'self' data:;"

# Strict Transport Security (Uncomment when custom domain is live with HTTPS)
# [[headers]]
#   for = "/*"
#   [headers.values]
#     Strict-Transport-Security = "max-age=31536000; includeSubDomains; preload"

# Font Caching (Sessie 81 - Android Chrome ASCII Box Rendering Fix)
# Aggressive caching for font subset (immutable after deploy)
[[headers]]
  for = "/styles/fonts/*"
  [headers.values]
    # 1-year cache (font never changes after deploy)
    Cache-Control = "public, max-age=31536000, immutable"
    # CORS headers for cross-origin font loading
    Access-Control-Allow-Origin = "*"
