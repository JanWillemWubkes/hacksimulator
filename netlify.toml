# Netlify configuration for HackSimulator.nl
# Documentation: https://docs.netlify.com/configure-builds/file-based-configuration/

[build]
  # Publish directory (root of repo for vanilla JS)
  publish = "."

  # No build command needed (vanilla JS, no bundler)
  command = "echo 'No build step required for vanilla JS'"

# Build settings
[build.processing]
  skip_processing = true  # Disable Netlify asset optimization (we manage bundle size manually)

# Cache busting settings
[build.environment]
  NODE_VERSION = "18"

# Redirects (SPA fallback - disabled for now, not needed for vanilla JS)
# [[redirects]]
#   from = "/*"
#   to = "/index.html"
#   status = 200

# Custom Domain Redirects (Activate when hacksimulator.nl is live)
# Uncomment these redirects after domain is configured in Netlify

# Redirect www to apex domain
[[redirects]]
  from = "https://www.hacksimulator.nl/*"
  to = "https://hacksimulator.nl/:splat"
  status = 301
  force = true

# Force HTTPS
# [[redirects]]
#   from = "http://hacksimulator.nl/*"
#   to = "https://hacksimulator.nl/:splat"
#   status = 301
#   force = true

# [[redirects]]
#   from = "http://www.hacksimulator.nl/*"
#   to = "https://hacksimulator.nl/:splat"
#   status = 301
#   force = true

# Optional: Redirect old Netlify subdomain to custom domain
[[redirects]]
  from = "https://famous-frangollo-b5a758.netlify.app/*"
  to = "https://hacksimulator.nl/:splat"
  status = 301
  force = true

# Security Headers
[[headers]]
  for = "/*"
  [headers.values]
    # Prevent clickjacking
    X-Frame-Options = "SAMEORIGIN"

    # Prevent MIME sniffing
    X-Content-Type-Options = "nosniff"

    # XSS Protection
    X-XSS-Protection = "1; mode=block"

    # Referrer Policy
    Referrer-Policy = "strict-origin-when-cross-origin"

    # Cross-Origin-Opener-Policy (M5 Best Practices: Isolate browsing context)
    Cross-Origin-Opener-Policy = "same-origin"

    # Content Security Policy (M5 Performance: Moved from HTML meta tag for faster parsing)
    # 'unsafe-hashes' allows onload event handlers for deferred CSS loading
    # font-src: 'self' data: for base64 inline fonts, fonts.gstatic.com for Google Fonts
    # style-src: fonts.googleapis.com for Google Fonts CSS (Sessie 95: Font loading fix)
    # connect-src allows Google Analytics API calls (Sessie 91: GA4 integration)
    # M5.5 Monetization: AdSense domains added (pagead2.googlesyndication.com, googleads.g.doubleclick.net, adservice.google.com)
    # CSP strengthened in Sessie 96 - Security Review: Added object-src, base-uri, form-action
    Content-Security-Policy = "default-src 'self'; script-src 'self' 'unsafe-hashes' 'unsafe-inline' https://www.googletagmanager.com https://pagead2.googlesyndication.com https://googleads.g.doubleclick.net https://adservice.google.com https://consent.cookiebot.com https://consentcdn.cookiebot.com; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; font-src 'self' data: https://fonts.gstatic.com; img-src 'self' data: https://pagead2.googlesyndication.com https://googleads.g.doubleclick.net https://consent.cookiebot.com https://consentcdn.cookiebot.com; frame-src https://googleads.g.doubleclick.net https://consentcdn.cookiebot.com; connect-src 'self' https://www.google-analytics.com https://*.google-analytics.com https://pagead2.googlesyndication.com https://consent.cookiebot.com https://consentcdn.cookiebot.com; object-src 'none'; base-uri 'self'; form-action 'self';"

# Strict Transport Security (Upgraded Sessie 97 - Security Headers B → A)
# 1-year max-age: browser remembers HTTPS-only for 12 months
[[headers]]
  for = "/*"
  [headers.values]
    Strict-Transport-Security = "max-age=31536000; includeSubDomains"

# Permissions Policy (Sessie 97 - Security Headers B → A)
# Restrict browser features not needed by the application
[[headers]]
  for = "/*"
  [headers.values]
    Permissions-Policy = "geolocation=(), microphone=(), camera=(), payment=(), usb=(), magnetometer=(), gyroscope=(), accelerometer=()"

# Font Caching (Sessie 81 - Android Chrome ASCII Box Rendering Fix)
# Aggressive caching for font subset (immutable after deploy)
[[headers]]
  for = "/styles/fonts/*"
  [headers.values]
    # 1-year cache (font never changes after deploy)
    Cache-Control = "public, max-age=31536000, immutable"
    # CORS headers for cross-origin font loading
    Access-Control-Allow-Origin = "*"
