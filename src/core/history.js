export default new class{constructor(t=100){this.maxSize=t,this.history=[],this.currentIndex=-1,this.storageKey="hacksim_history",this.load()}add(t){if(!t||!t.trim())return;const s=t.trim();this.history.length>0&&this.history[this.history.length-1]===s?this.currentIndex=this.history.length:(this.history.push(s),this.history.length>this.maxSize&&this.history.shift(),this.currentIndex=this.history.length,this.save())}previous(){return 0===this.history.length?null:(this.currentIndex>0&&this.currentIndex--,this.history[this.currentIndex])}next(){return 0===this.history.length?null:this.currentIndex<this.history.length-1?(this.currentIndex++,this.history[this.currentIndex]):this.currentIndex===this.history.length-1?(this.currentIndex=this.history.length,""):""}resetIndex(){this.currentIndex=this.history.length}getAll(){return[...this.history]}get(t){return t>=0&&t<this.history.length?this.history[t]:null}search(t){const s=new RegExp(t,"i");return this.history.filter(t=>s.test(t))}clear(){this.history=[],this.currentIndex=-1,this.save()}size(){return this.history.length}save(){try{localStorage.setItem(this.storageKey,JSON.stringify(this.history))}catch(t){console.warn("Failed to save history to localStorage:",t)}}load(){try{const t=localStorage.getItem(this.storageKey);if(t){const s=JSON.parse(t);Array.isArray(s)?(this.history=s,this.currentIndex=this.history.length,this.history.length>this.maxSize&&(this.history=this.history.slice(-this.maxSize),this.save())):(console.warn("Invalid history data format in localStorage, resetting"),this.history=[],this.currentIndex=-1)}}catch(t){console.warn("Failed to load history from localStorage:",t),this.history=[],this.currentIndex=-1}}toString(){return this.history.map((t,s)=>`${s+1}  ${t}`).join("\n")}};