window.CommandSearchModal=class{constructor(e){this.registry=e,this.searchStrategy=new window.SimpleFilterStrategy,this.overlay=null,this.modal=null,this.searchInput=null,this.resultsContainer=null,this.closeButton=null,this.cancelButton=null,this.isOpen=!1,this.selectedIndex=0,this.filteredCommands=[],this.allCommands=[],this.categoryOrder=["system","filesystem","network","security","special"]}init(){this.overlay=document.getElementById("command-search-modal-overlay"),this.modal=document.querySelector(".modal-content.command-search-modal"),this.searchInput=document.getElementById("command-search-input"),this.resultsContainer=document.getElementById("command-search-results"),this.closeButton=this.modal.querySelector(".modal-close"),this.cancelButton=document.getElementById("command-search-cancel"),this.overlay&&this.searchInput&&this.resultsContainer?(this.loadAllCommands(),this.attachEventListeners(),console.log("CommandSearchModal initialized")):console.error("CommandSearchModal: Required DOM elements not found")}loadAllCommands(){this.allCommands=[];this.registry.list().forEach(e=>{const t=this.registry.get(e);t&&this.allCommands.push({name:e,description:t.description||"No description",category:t.category||"other",usage:t.usage||e})}),this.allCommands.sort((e,t)=>{const s=this.categoryOrder.indexOf(e.category)-this.categoryOrder.indexOf(t.category);return 0!==s?s:e.name.localeCompare(t.name)})}attachEventListeners(){this.searchInput.addEventListener("input",e=>{this.handleSearch(e.target.value)}),this.searchInput.addEventListener("keydown",e=>{this.handleKeyboard(e)}),this.closeButton&&this.closeButton.addEventListener("click",()=>this.close()),this.cancelButton&&this.cancelButton.addEventListener("click",()=>this.close()),this.overlay.addEventListener("click",e=>{e.target===this.overlay&&this.close()}),this.modal.addEventListener("click",e=>{e.stopPropagation()})}open(){this.isOpen=!0,this.overlay.classList.add("active"),this.searchInput.value="",this.selectedIndex=0,this.filteredCommands=[...this.allCommands],this.render(),setTimeout(()=>{this.searchInput.focus()},100)}close(){this.isOpen=!1,this.overlay.classList.remove("active");const e=document.getElementById("terminal-input");e&&e.focus()}handleSearch(e){this.filteredCommands=this.searchStrategy.search(e,this.allCommands),this.selectedIndex=0,this.render()}handleKeyboard(e){switch(e.key){case"ArrowDown":e.preventDefault(),this.moveSelection(1);break;case"ArrowUp":e.preventDefault(),this.moveSelection(-1);break;case"Enter":e.preventDefault(),this.selectCommand();break;case"Escape":e.preventDefault(),this.close()}}moveSelection(e){const t=this.filteredCommands.length-1;this.selectedIndex+=e,this.selectedIndex<0&&(this.selectedIndex=0),this.selectedIndex>t&&(this.selectedIndex=t),this.updateSelection(),this.scrollSelectedIntoView()}updateSelection(){this.resultsContainer.querySelectorAll(".command-item").forEach((e,t)=>{t===this.selectedIndex?e.classList.add("selected"):e.classList.remove("selected")})}scrollSelectedIntoView(){const e=this.resultsContainer.querySelector(".command-item.selected");e&&e.scrollIntoView({behavior:"smooth",block:"nearest"})}selectCommand(){if(0===this.filteredCommands.length)return;const e=this.filteredCommands[this.selectedIndex];e&&this.insertCommandInTerminal(e.name)}insertCommandInTerminal(e){const t=document.getElementById("terminal-input");t&&(t.value=e,this.close(),t.focus(),t.setSelectionRange(e.length,e.length))}render(){if(0===this.filteredCommands.length)return void this.renderEmpty();const e=this.groupByCategory(this.filteredCommands);let t="";this.categoryOrder.forEach(s=>{const n=e[s];n&&0!==n.length&&(t+=this.renderCategory(s,n))}),this.resultsContainer.innerHTML=t,this.attachCommandClickHandlers(),this.updateSelection()}groupByCategory(e){const t={};return e.forEach(e=>{t[e.category]||(t[e.category]=[]),t[e.category].push(e)}),t}renderCategory(e,t){let s=`\n      <div class="command-category">\n        <h3 class="command-category-header">${this.formatCategoryName(e)} (${t.length})</h3>\n    `;return t.forEach((e,t)=>{const n=this.filteredCommands.indexOf(e);s+=this.renderCommandItem(e,n)}),s+="</div>",s}renderCommandItem(e,t){return`\n      <div class="command-item" data-command="${e.name}" data-index="${t}">\n        <span class="command-item-name">${e.name}</span>\n        <span class="command-item-description">- ${e.description}</span>\n      </div>\n    `}renderEmpty(){this.resultsContainer.innerHTML='\n      <div class="command-search-empty">\n        <div class="command-search-empty-icon">?</div>\n        <div class="command-search-empty-text">\n          Geen commands gevonden<br>\n          <small>Probeer een andere zoekterm</small>\n        </div>\n      </div>\n    '}formatCategoryName(e){return{system:"SYSTEM",filesystem:"FILESYSTEM",network:"NETWORK",security:"SECURITY",special:"SPECIAL"}[e]||e.toUpperCase()}attachCommandClickHandlers(){this.resultsContainer.querySelectorAll(".command-item").forEach((e,t)=>{e.addEventListener("click",()=>{this.selectedIndex=t,this.selectCommand()}),e.addEventListener("mouseenter",()=>{this.selectedIndex=t,this.updateSelection()})})}};