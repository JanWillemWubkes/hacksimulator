import e from"../analytics/tracker.js";const t="hacksim_feedback",n={_currentRating:0,_isInitialized:!1,init(){this._isInitialized?console.warn("Feedback manager already initialized"):("loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>this._setupEventHandlers()):this._setupEventHandlers(),this._isInitialized=!0,console.log("Feedback manager initialized"))},_setupEventHandlers(){const e=document.getElementById("footer-feedback-link"),t=document.getElementById("feedback-modal"),n=t?.querySelector(".modal-close"),a=document.getElementById("feedback-submit"),o=document.getElementById("feedback-cancel"),s=document.querySelectorAll(".rating-stars .star");if(!e||!t)return void console.warn("Feedback UI elements not found in DOM");e.addEventListener("click",e=>{e.preventDefault(),this._openModal()}),n&&n.addEventListener("click",()=>{this._closeModal()}),t.addEventListener("click",e=>{e.target===t&&this._closeModal()}),s.forEach(e=>{e.addEventListener("click",()=>{const t=parseInt(e.dataset.rating,10);this._setRating(t)}),e.addEventListener("mouseenter",()=>{const t=parseInt(e.dataset.rating,10);this._highlightStars(t)})});const c=document.querySelector(".rating-stars");c&&c.addEventListener("mouseleave",()=>{this._highlightStars(this._currentRating)}),a&&a.addEventListener("click",()=>{this._submitFeedback()}),o&&o.addEventListener("click",()=>{this._closeModal()}),document.addEventListener("keydown",e=>{"Escape"===e.key&&t.classList.contains("active")&&this._closeModal()})},_openModal(){const e=document.getElementById("feedback-modal");e&&(e.classList.add("active"),e.setAttribute("aria-hidden","false"),this._resetForm(),console.log("Feedback modal opened"))},_closeModal(){const e=document.getElementById("feedback-modal");e&&(e.classList.remove("active"),e.setAttribute("aria-hidden","true"),console.log("Feedback modal closed"))},_setRating(e){this._currentRating=e,this._highlightStars(e),console.log("Rating selected:",e)},_highlightStars(e){document.querySelectorAll(".rating-stars .star").forEach((t,n)=>{n<e?t.classList.add("active"):t.classList.remove("active")})},_resetForm(){this._currentRating=0,this._highlightStars(0);const e=document.getElementById("feedback-comment");e&&(e.value="");const t=document.getElementById("feedback-modal"),n=t?.querySelector(".feedback-error");n&&n.classList.remove("visible")},_submitFeedback(){if(0===this._currentRating)return void this._showError("Selecteer eerst een rating (1-5 sterren)");const e=document.getElementById("feedback-comment"),t=e?.value.trim()||"",n={rating:this._currentRating,comment:t,timestamp:(new Date).toISOString(),userAgent:navigator.userAgent,screenSize:`${window.innerWidth}x${window.innerHeight}`};this._saveFeedback(n),this._trackFeedbackAnalytics(this._currentRating,t.length>0),this._showSuccess(),console.log("Feedback submitted:",{rating:n.rating,hasComment:t.length>0,timestamp:n.timestamp})},_saveFeedback(e){try{const n=this.getAllFeedback();n.push(e),localStorage.setItem(t,JSON.stringify(n)),console.log("Feedback saved to localStorage. Total entries:",n.length)}catch(t){console.error("Could not save feedback to localStorage:",t),console.log("FEEDBACK (localStorage failed):",e)}},_trackFeedbackAnalytics(t,n){try{e.trackEvent("feedback_submitted",{rating:t,has_comment:n,timestamp:Date.now()})}catch(e){console.warn("Could not track feedback analytics:",e)}},_showSuccess(){const e=document.getElementById("feedback-modal"),t=e?.querySelector(".modal-content");if(!t)return;const n=t.innerHTML;t.innerHTML='\n      <div class="feedback-success" style="text-align: center; padding: 40px 20px;">\n        <div style="color: var(--color-success); font-size: 3rem; margin-bottom: 20px; font-family: var(--font-terminal); letter-spacing: 0.15em;">[ OK ]</div>\n        <h2 style="color: var(--color-success); margin-bottom: 16px; font-size: 2rem; text-transform: uppercase; letter-spacing: 1px;">Bedankt!</h2>\n        <p style="color: var(--color-modal-text); font-size: 1rem;">Je feedback helpt ons HackSimulator.nl te verbeteren.</p>\n      </div>\n    ',setTimeout(()=>{t.innerHTML=n,this._closeModal(),this._setupEventHandlers()},2e3)},_showError(e){const t=document.getElementById("feedback-modal"),n=t?.querySelector(".feedback-error");n&&(n.textContent=e,n.classList.add("visible"),setTimeout(()=>{n.classList.remove("visible")},3e3))},getAllFeedback(){try{const e=localStorage.getItem(t);return e?JSON.parse(e):[]}catch(e){return console.warn("Could not retrieve feedback from localStorage:",e),[]}},exportFeedback(){const e=this.getAllFeedback();if(0===e.length)return void console.log("No feedback to export");const t=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),n=URL.createObjectURL(t),a=document.createElement("a");a.href=n,a.download=`hacksimulator-feedback-${Date.now()}.json`,document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(n),console.log("Feedback exported:",e.length,"entries")},clearAllFeedback(){try{localStorage.removeItem(t),console.log("All feedback cleared from localStorage")}catch(e){console.error("Could not clear feedback:",e)}},getStats(){const e=this.getAllFeedback();if(0===e.length)return{total:0,averageRating:0,withComments:0,ratingDistribution:{}};const t={total:e.length,averageRating:0,withComments:0,ratingDistribution:{1:0,2:0,3:0,4:0,5:0}};let n=0;return e.forEach(e=>{n+=e.rating,t.ratingDistribution[e.rating]++,e.comment&&e.comment.length>0&&t.withComments++}),t.averageRating=(n/e.length).toFixed(2),t}};export default n;