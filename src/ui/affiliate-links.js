import i from"../analytics/events.js";import n from"../config/affiliate-config.js";const t=new class{constructor(){this.initialized=!1,this.linkCount=0}init(){window.location.pathname.includes("/blog/")?this.initialized?console.warn("[AffiliateLinks] Already initialized"):(this.attachClickHandlers(),this.initialized=!0,console.log(`[AffiliateLinks] Initialized on blog page - tracking ${this.linkCount} links`)):console.log("[AffiliateLinks] Skipping init - not a blog page")}attachClickHandlers(){const i=document.querySelectorAll("a.affiliate-link");this.linkCount=i.length,0!==this.linkCount?(i.forEach(i=>{i.addEventListener("click",i=>{this.handleAffiliateClick(i.target)})}),console.log(`[AffiliateLinks] Attached handlers to ${this.linkCount} links`)):console.warn("[AffiliateLinks] No affiliate links found on this page")}handleAffiliateClick(t){const a=t.dataset.program,e=t.dataset.product||"unknown";a?n.isValidProgram(a)?(i.affiliateClick(a,e),console.log(`[AffiliateLinks] Tracked click: ${a}/${e}`)):console.warn(`[AffiliateLinks] Unknown affiliate program: ${a}`):console.warn("[AffiliateLinks] Click on link without data-program attribute",t)}static createDisclosureBanner(){return`\n      <div class="affiliate-banner">\n        <p>\n          ${n.disclosure.banner}\n          <a href="../assets/legal/affiliate-disclosure.html" target="_blank" rel="noopener noreferrer">\n            ${n.disclosure.linkText}\n          </a>\n        </p>\n      </div>\n    `}static createAffiliateLink({program:i,product:t,url:a,text:e,cssClass:l="btn-small"}){if(!n.isValidProgram(i))return console.error(`[AffiliateLinks] Invalid program: ${i}`),"";return`\n      <a href="${a}"\n         target="_blank"\n         rel="sponsored noopener noreferrer"\n         class="affiliate-link ${l}"\n         data-program="${i}"\n         data-product="${t}"\n         aria-label="${e} - ${n.getProgram(i).name} affiliate link">\n        ${e}\n        <span class="affiliate-badge">${n.disclosure.badge}</span>\n      </a>\n    `}getStats(){const i=document.querySelectorAll("a.affiliate-link"),n={};return i.forEach(i=>{const t=i.dataset.program||"unknown";n[t]=(n[t]||0)+1}),{totalLinks:i.length,programCounts:n,initialized:this.initialized,isBlogPage:window.location.pathname.includes("/blog/")}}validateLinks(){const i=document.querySelectorAll("a.affiliate-link"),n=[];return i.forEach((i,t)=>{i.dataset.program||n.push(`Link ${t+1}: Missing data-program attribute`),i.dataset.product||n.push(`Link ${t+1}: Missing data-product attribute`);const a=i.getAttribute("rel");a&&a.includes("sponsored")||n.push(`Link ${t+1}: Missing rel="sponsored" (GDPR requirement)`),"_blank"===!i.getAttribute("target")&&n.push(`Link ${t+1}: Should have target="_blank"`),a&&a.includes("noopener")||n.push(`Link ${t+1}: Missing rel="noopener" (security)`)}),{valid:0===n.length,totalLinks:i.length,issues:n}}};export default t;