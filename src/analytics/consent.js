import e from"./tracker.js";import n from"./events.js";const t="hacksim_analytics_consent",o="hacksim_consent_banner_shown",s={hasShownBanner:!1,shouldShowBanner(){if(null!==this.hasConsent())return!1;if(this.hasShownBanner)return!1;try{const e=localStorage.getItem(o);if(e){const n=new Date(e);if((new Date-n)/36e5<24)return!1}}catch(e){console.warn("Could not check consent banner history")}return!0},hasConsent(e="analytics"){try{const n=localStorage.getItem(t);if(null===n)return null;if("true"===n||"false"===n){const o="true"===n,s={necessary:!0,analytics:o,advertising:!1};return localStorage.setItem(t,JSON.stringify(s)),"necessary"===e||"analytics"===e&&o}const o=JSON.parse(n);return void 0!==o[e]?o[e]:null}catch(e){return console.warn("Could not parse consent data:",e),null}},showBanner(){if(!this.shouldShowBanner())return void console.log("Cookie consent banner not shown (already responded or shown recently)");this.hasShownBanner=!0;try{localStorage.setItem(o,(new Date).toISOString())}catch(e){console.warn("Could not save banner shown state")}const e=document.getElementById("cookie-consent");if(!e)return void console.error("Cookie consent banner element not found");e.classList.add("active"),e.setAttribute("aria-hidden","false");const n=document.getElementById("cookie-accept-all"),t=document.getElementById("cookie-accept-analytics"),s=document.getElementById("cookie-decline");n&&n.addEventListener("click",()=>this.acceptConsent("all")),t&&t.addEventListener("click",()=>this.acceptConsent("analytics")),s&&s.addEventListener("click",()=>this.declineConsent()),console.log("Cookie consent banner shown")},acceptConsent(o="all"){const s={necessary:!0,analytics:"all"===o||"analytics"===o,advertising:"all"===o};localStorage.setItem(t,JSON.stringify(s)),this.hideBanner(),s.analytics&&(e.init("ga4"),n.legalEvent("cookies_accepted_analytics")),s.advertising&&(this.loadAdSense(),n.legalEvent("cookies_accepted_advertising")),console.log("User accepted cookies:",s)},declineConsent(){localStorage.setItem(t,JSON.stringify({necessary:!0,analytics:!1,advertising:!1})),this.hideBanner(),console.log("User declined optional cookies")},loadAdSense(){const e=document.getElementById("adsense-footer");if(e){if(e.style.display="block",window.hasAdvertisingConsent=!0,!window.adsbygoogle){const e=document.createElement("script");e.src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js",e.async=!0,e.crossOrigin="anonymous",e.setAttribute("data-ad-client","ca-pub-6345664385525701"),document.head.appendChild(e),e.onload=()=>{(window.adsbygoogle=window.adsbygoogle||[]).push({})}}console.log("AdSense container loaded")}else console.warn("AdSense container not found (#adsense-footer)")},hideBanner(){const e=document.getElementById("cookie-consent");e&&(e.classList.remove("active"),e.setAttribute("aria-hidden","true"))},checkAndShowBanner(){setTimeout(()=>{this.showBanner()},2e3)},showConsentSettings(){this.hasShownBanner=!1;const e=document.getElementById("cookie-consent");e&&(e.classList.add("active"),e.setAttribute("aria-hidden","false"))}};document.addEventListener("DOMContentLoaded",()=>{const e=document.getElementById("cookie-settings");e&&e.addEventListener("click",e=>{e.preventDefault(),s.showConsentSettings()})});export default s;